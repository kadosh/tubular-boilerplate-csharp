(function(n){"use strict";n.module("tubular-widget.directives",["tubular.services"]).directive("tbWidgetContainer",[function(){return{template:'<div class="container-fluid"><ng-transclude><\/ng-transclude><\/div>',restrict:"E",replace:!0,transclude:!0,scope:{name:"@?containerName",fixedWidgets:"@?fixedWidgets"},controller:["$scope","$element","localStorageService",function(t,i,r){t.name=t.name||"tbcontainer";t.fixedWidgets=n.isDefined(t.fixedWidgets)&&t.fixedWidgets=="true";t.widgets=[];t.settings=r.get(t.name+"_data");t.redraw=function(){var r=i.children("div.row");n.forEach(t.widgetsAsRows,function(t){if(!t[0].isHidden){var r=n.element('<div class="row"><\/div>');i.append(r);n.forEach(t,function(n){r.append(n.content)})}});r.remove()};t.divideIntoRows=function(){for(var n=t.widgets.slice(0),i=[];n.length;)n[0].fullWidth||n[0].isHidden?(n[0].row=i.length,i.push(n.splice(0,1))):n[1]&&n[1].fullWidth?(n[1].row=i.length,i.push(n.splice(1,1))):(n[0].row=i.length,n[1]&&(n[1].row=i.length),i.push(n.splice(0,2)));return t.widgetsAsRows=i};t.setWidgetsCapabilities=function(){n.forEach(t.widgets,function(n){n.canUp=n.canDown=n.canLeft=n.canRight=!0});n.forEach(t.widgetsAsRows[0],function(n){n.canUp=!1});n.forEach(t.widgetsAsRows[t.widgetsAsRows.length-1],function(n){n.canDown=!1});n.forEach(t.widgetsAsRows,function(n){n.length==1?(n[0].canRight=!1,n[0].canLeft=!1):(n[0].canRight=!0,n[0].canLeft=!1,n[1].canRight=!1,n[1].canLeft=!0)})};t.move=function(i,r){var u=i.row,f=r=="up"?u-1:r=="down"?u+1:u,o=t.widgetsAsRows[u],h=t.widgetsAsRows[f],s,e;switch(r){case"up":case"down":o[0].fullWidth||h[0].fullWidth?(e=t.widgetsAsRows[u],t.widgetsAsRows[u]=t.widgetsAsRows[f],t.widgetsAsRows[f]=e):i.canLeft?(s=t.widgetsAsRows[f].length==2?1:0,e=t.widgetsAsRows[u][1],t.widgetsAsRows[u][1]=t.widgetsAsRows[f][s],t.widgetsAsRows[f][s]=e):(e=t.widgetsAsRows[u][0],t.widgetsAsRows[u][0]=t.widgetsAsRows[f][0],t.widgetsAsRows[f][0]=e);break;case"left":case"right":e=o[0];o[0]=o[1];o[1]=e}t.widgets=[].concat.apply([],t.widgetsAsRows);n.forEach(t.widgets,function(n,t){n.position=t});t.recalculate()};t.recalculate=function(){t.divideIntoRows();t.setWidgetsCapabilities();t.saveSettings()};t.saveSettings=function(){var i={};n.forEach(t.widgets,function(n){i[n.name]={position:n.position,fullWidth:n.fullWidth,collapsed:n.collapsed}});r.set(t.name+"_data",i)}}],compile:function(){return{post:function(t){!t.fixedWidgets&&t.settings&&(n.forEach(t.widgets,function(n,i){var r=t.settings[n.name];(n.position=i,r)&&(n.fullWidth=r.fullWidth,n.collapsed=r.collapsed,n.position=r.position)}),t.widgets.sort(function(n,t){return n.position>t.position}));t.recalculate();t.redraw()}}}}}]).directive("tbWidget",[function(){return{template:'<div class="widget-panel" ng-hide="isHidden"><div class="tubular-overlay maximized" ng-show="maximized"><\/div><div ng-class="{ \'col-md-6\': !fullWidth, \'col-md-12\': fullWidth, \'maximized\': maximized}"><div class="panel panel-default"><div class="tubular-overlay row" ng-show="showOverlay"><div><div class="fa fa-refresh fa-2x fa-spin"><\/div><\/div><\/div><div class="panel-heading"><span>{{title}}<\/span> <div class="pull-right"><button ng-hide="container.fixedWidgets || maximized" ng-disabled="!canUp" ng-click="move(\'up\')" class="btn btn-default btn-xs"  title="{{\'UI_MOVEUP\'| translate}}"><span><i class="fa fa-arrow-up"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || maximized" ng-disabled="!canDown" ng-click="move(\'down\')" class="btn btn-default btn-xs"  title="{{\'UI_MOVEDOWN\'| translate}}"><span><i class=fa fa-arrow-down"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || maximized" ng-disabled="!canRight" ng-click="move(\'left\')" class="btn btn-default btn-xs"  title="{{\'UI_MOVERIGHT\'| translate}}"><span><i class="fa fa-arrow-right"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || maximized" ng-disabled="!canLeft" ng-click="move(\'right\')" class="btn btn-default btn-xs"  title="{{\'UI_MOVELEFT\'| translate}}"><span><i class="fa fa-arrow-left"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || fullWidth || maximized" ng-click="setWidth(2)" class="btn btn-default btn-xs" title="{{\'UI_TWOCOLS\'| translate}}"><span><i class="fa fa-arrows-h"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || !fullWidth || maximized" ng-click="setWidth(1)" class="btn btn-default btn-xs" title="{{\'UI_ONECOL\'| translate}}"><span><i class="fa fa-arrows-h"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || collapsed || maximized" ng-click="collapsed = true" class="btn btn-default btn-xs" title="{{\'UI_COLLAPSE\'| translate}}"><span><i class="fa fa-angle-up"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || !collapsed || maximized" ng-click="collapsed = false" class="btn btn-default btn-xs" title="{{\'UI_EXPAND\'| translate}}"><span><i class="fa fa-angle-down"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || maximized" ng-click="maximized = true;" class="btn btn-default btn-xs" title="{{\'UI_MAXIMIZE\'| translate}}"><span><i class="fa fa-expand"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || !maximized" ng-click="maximized = false" class="btn btn-default btn-xs" title="{{\'UI_RESTORE\'| translate}}"><span><i class="fa fa-compress"><\/i><\/span><\/button><\/div><\/div><div class="panel-body" ng-hide="collapsed && !maximized"><ng-transclude><\/ng-transclude><\/div><div class="panel-body" ng-show="collapsed && !maximized">{{summary}}<\/div><\/div>',restrict:"E",replace:!0,transclude:!0,scope:{title:"@",name:"@?widgetName",summary:"@?widgetSummary",isHidden:"@?isHidden",fullWidth:"@?fullWidth",showOverlay:"=?showOverlay"},controller:["$scope","$element",function(t,i){t.name=t.name||"tbwidget";t.fullWidth=n.isDefined(t.fullWidth)&&t.fullWidth=="true";t.isHidden=n.isDefined(t.isHidden)&&t.isHidden=="true";t.collapsed=!1;t.maximized=!1;t.position=0;t.content=i;t.container=t.$parent.$parent;t.canUp=!1;t.canDown=!1;t.canLeft=!1;t.canRight=!1;t.container.widgets.push(t);t.setWidth=function(n){t.fullWidth=n==2;t.container.recalculate();t.container.redraw()};t.$watch("collapsed",function(){t.container.saveSettings()});t.move=function(n){t.container.move(this,n);t.container.redraw()}}]}}]).directive("tbWidgetActions",[function(){return{template:'<div class="pull-right"><ng-transclude><\/ng-transclude><\/div>',restrict:"E",replace:!0,transclude:!0,require:"^tbWidget",controller:["$scope",function(n){n.$widget=n.$parent.$parent.$parent}],link:function(n,t){var i=t.parents(".panel").find(".panel-heading");i.append(t)}}}])})(window.angular);