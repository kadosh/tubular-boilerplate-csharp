(function(){"use strict";angular.module("tubular-widget.directives",["tubular.services"]).directive("tbWidgetContainer",[function(){return{template:'<div class="container"><ng-transclude><\/ng-transclude><\/div>',restrict:"E",replace:!0,transclude:!0,scope:{name:"@?containerName"},controller:["$scope","localStorageService",function(n,t){n.name=n.name||"tbcontainer";n.widgets=[];n.settings=t.get(n.name+"_data");n.redraw=function(){var i={};angular.forEach(n.widgets,function(n){var t=n.content.parent();n.oneColumn?(t.find("div.widget-panel").length===1&&t.next().hasClass("row")&&(t.append(t.next().find("div.widget-panel")),t.next().find("div.widget-panel").length===0&&t.next().remove()),t.find("div.widget-panel").length>2&&$('<div class="row"><\/div>').insertAfter(t).append(t.find("div.widget-panel").last())):t.find("div.widget-panel").length>1&&$('<div class="row"><\/div>').insertBefore(t).append(n.content);i[n.name]={position:n.pos,oneColumn:n.oneColumn}});t.set(n.name+"_data",i)}}],compile:function(){return{post:function(n){n.settings&&angular.forEach(n.widgets,function(t){var i=n.settings[t.name];i&&(t.oneColumn=i.oneColumn,t.pos!==i.pos&&t.moveAt(i.pos))})}}}}}]).directive("tbWidget",[function(){return{template:'<div class="widget-panel"><div class="tubular-overlay maximize" ng-show="maximize"><\/div><div ng-class="{ \'col-md-6\': oneColumn, \'col-md-12\': !oneColumn, \'maximize\': maximize}"><div class="panel panel-default"><div class="panel-heading">{{title}}<div class="pull-right"><div class="dropdown"><button class="btn btn-xs btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span class="caret"><\/span><\/button><ul class="dropdown-menu dropdown-menu-right"><li ng-hide="!oneColumn || maximize"><a href="#" ng-click="oneColumn = false">{{\'UI_TWOCOLS\'| translate}}<\/a><\/li><li ng-hide="oneColumn || maximize"><a href="#" ng-click="oneColumn = true">{{\'UI_ONECOL\'| translate}}<\/a><\/li><li ng-hide="maximize"><a href="#" ng-click="maximize = true">{{\'UI_MAXIMIZE\'| translate}}<\/a><\/li><li ng-hide="!maximize"><a href="#" ng-click="maximize = false">{{\'UI_RESTORE\'| translate}}<\/a><\/li><li ng-hide="top || maximize"><a href="#" ng-click="move(-2)">{{\'UI_MOVEUP\'| translate}}<\/a><\/li><li ng-hide="bottom || maximize"><a href="#" ng-click="move(2)">{{\'UI_MOVEDOWN\'| translate}}<\/a><\/li><li ng-hide="!oneColumn || !even || maximize"><a href="#" ng-click="move(1)">{{\'UI_MOVERIGHT\'| translate}}<\/a><\/li><li ng-hide="!oneColumn || even || maximize"><a href="#" ng-click="move(-1)">{{\'UI_MOVELEFT\'| translate}}<\/a><\/li><\/ul><\/div><\/div><\/div><div class="panel-body"><ng-transclude><\/ng-transclude><\/div><\/div>',restrict:"E",replace:!0,transclude:!0,scope:{title:"@",name:"@?widgetName"},controller:function(n,t){function i(n,t){var i=n.parentNode,r=n.nextSibling===t?n:n.nextSibling;t.parentNode.insertBefore(n,t);i.insertBefore(t,r)}n.name=n.name||"tbwidget";n.oneColumn=!0;n.maximize=!1;n.pos=0;n.content=t;n.container=n.$parent.$parent;n.container.widgets.push(n);n.calculatePositions=function(t){n.top=t===0||t===1;n.bottom=t===n.container.widgets.length-1||t===n.container.widgets.length-2;n.even=t%2==0;n.pos=t};n.$watch("$parent.widgets",function(){var t=n.container.widgets.indexOf(n);n.calculatePositions(t)});n.$watch("oneColumn",function(){n.container.redraw()});n.move=function(t){n.moveAt(n.pos+t)};n.moveAt=function(r){var u=n.container.widgets[r];u&&(n.container.widgets[r]=n,n.container.widgets[n.pos]=u,u.calculatePositions(n.pos),n.calculatePositions(r),i(u.content[0],t[0]),n.container.redraw())}}}}])})();